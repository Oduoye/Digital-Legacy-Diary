<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Digital Legacy Diary</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Merriweather:wght@300;400;700&display=swap" rel="stylesheet">
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
    
    <!-- Tawk.to Live Chat - Custom Implementation -->
    <script type="text/javascript">
    var Tawk_API = Tawk_API || {};
    var Tawk_LoadStart = new Date();
    
    // CRITICAL: Hide the widget completely on load and prevent default behavior
    Tawk_API.onLoad = function(){
      console.log('âœ… Tawk.to loaded successfully');
      // Immediately hide the widget and prevent any default display
      if (window.Tawk_API && window.Tawk_API.hideWidget) {
        window.Tawk_API.hideWidget();
      }
      
      // Remove any default Tawk.to elements that might appear
      setTimeout(() => {
        const tawkElements = document.querySelectorAll('[id*="tawk"], [class*="tawk"]');
        tawkElements.forEach(el => {
          if (el.id !== 'tawkchat-container') {
            el.style.display = 'none';
          }
        });
      }, 100);
    };
    
    // Prevent any default widget behavior
    Tawk_API.onBeforeLoad = function(){
      // Ensure widget starts hidden
      return true;
    };
    
    // Customize widget when maximized through our button
    Tawk_API.onChatMaximized = function(){
      console.log('ðŸ“ˆ Tawk.to chat maximized via custom button');
      
      setTimeout(() => {
        try {
          const tawkWidget = document.getElementById('tawkchat-container');
          if (tawkWidget) {
            // Make the widget larger and better positioned
            tawkWidget.style.width = '400px';
            tawkWidget.style.height = '600px';
            tawkWidget.style.maxHeight = '80vh';
            tawkWidget.style.bottom = '20px';
            tawkWidget.style.right = '20px';
            tawkWidget.style.borderRadius = '12px';
            tawkWidget.style.boxShadow = '0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)';
            tawkWidget.style.zIndex = '9999';
          }
          
          // Style the iframe
          const tawkIframe = document.querySelector('#tawkchat-container iframe');
          if (tawkIframe) {
            tawkIframe.style.borderRadius = '12px';
          }
        } catch (error) {
          console.warn('Could not apply custom Tawk.to styling:', error);
        }
      }, 100);
    };
    
    // Hide widget when minimized
    Tawk_API.onChatMinimized = function(){
      console.log('ðŸ“‰ Tawk.to chat minimized');
      if (window.Tawk_API && window.Tawk_API.hideWidget) {
        window.Tawk_API.hideWidget();
      }
    };
    
    Tawk_API.onStatusChange = function(status){
      console.log('ðŸ“Š Tawk.to status changed to:', status);
    };
    
    // Load Tawk.to script with custom configuration
    (function(){
      var s1=document.createElement("script"),s0=document.getElementsByTagName("script")[0];
      s1.async=true;
      s1.src='https://embed.tawk.to/68495a4c2061f3190a9644ee/1itf8hfev';
      s1.charset='UTF-8';
      s1.setAttribute('crossorigin','*');
      
      // Add custom attributes to prevent default behavior
      s1.setAttribute('data-tawk-hide-default', 'true');
      
      s0.parentNode.insertBefore(s1,s0);
    })();
    
    // Additional safety measure to hide any default elements
    document.addEventListener('DOMContentLoaded', function() {
      setTimeout(() => {
        // Hide any Tawk.to elements that might appear by default
        const style = document.createElement('style');
        style.textContent = `
          /* Hide all default Tawk.to elements except our controlled container */
          [id*="tawk"]:not(#tawkchat-container) {
            display: none !important;
            visibility: hidden !important;
          }
          [class*="tawk"] {
            display: none !important;
            visibility: hidden !important;
          }
          /* Only show when explicitly maximized */
          #tawkchat-container {
            display: none !important;
          }
          #tawkchat-container.tawk-maximized {
            display: block !important;
          }
        `;
        document.head.appendChild(style);
      }, 500);
    });
    </script>
    
    <style>
    /* Enhanced custom styling for Tawk.to widget */
    #tawkchat-container {
      transition: all 0.3s ease-in-out !important;
      display: none !important; /* Hidden by default */
    }
    
    /* Only show when maximized */
    #tawkchat-container.tawk-maximized {
      display: block !important;
    }
    
    /* Ensure the widget appears above other elements */
    #tawkchat-container iframe {
      z-index: 9999 !important;
      border-radius: 12px !important;
    }
    
    /* Hide any default Tawk.to elements */
    [id*="tawk"]:not(#tawkchat-container),
    [class*="tawk"]:not(#tawkchat-container) {
      display: none !important;
      visibility: hidden !important;
    }
    
    /* Custom animations for the widget */
    @keyframes tawkSlideIn {
      from {
        opacity: 0;
        transform: translateY(20px) scale(0.95);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }
    
    #tawkchat-container.tawk-maximized {
      animation: tawkSlideIn 0.3s ease-out;
    }
    </style>
  </body>
</html>